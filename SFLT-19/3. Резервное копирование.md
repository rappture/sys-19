# Домашнее задание к занятию «Резервное копирование»
<br>

> ### Задание 1
> *	Составьте команду rsync, которая позволяет создавать зеркальную копию домашней директории пользователя в директорию /tmp/backup
> *	Необходимо исключить из синхронизации все директории, начинающиеся с точки (скрытые)
> *	Необходимо сделать так, чтобы rsync подсчитывал хэш-суммы для всех файлов, даже если их время модификации и размер идентичны в источнике и приемнике.
> *	На проверку направить скриншот с командой и результатом ее выполнения
>
### Ответ к заданию 1
:large_blue_diamond:	Установка rsync:

<kbd><img src="/img/sflt-3.1.1.png"></kbd>

:large_blue_diamond:	Состояние домашней директории и директории /tmp/backup/ до выполнения команды rsync (в обеих имеются файлы File1 с одинаковым размером и временем создания, но отличающимся содержимым, в директории /tmp/backup/ имеется лишний файл и лишняя скрытая директория): 

<kbd><img src="/img/sflt-3.1.2.png"></kbd>

:large_blue_diamond:	Скриншоты с командой и результатами ее выполнения:

<kbd><img src="/img/sflt-3.1.3.png"></kbd>

<kbd><img src="/img/sflt-3.1.4.png"></kbd>

:large_blue_diamond:	Использованные опции:
* `-a` – архивный режим, эквивалентный набору опций `-rlptgoD`;
* `-c` – пропускать файл или нет проверяется не по времени его изменения и размеру, а по контрольной сумме;
* `-vv` – для вывода дополнительной информации по выполняемой задаче на экран;
* `--exclude` – для указания исключений (в нашем случае – по паттерну `'/.*/'`); 
* `--delete-excluded` – для того, чтобы файлы в директории назначения не входили в исключения, заданные опцией `--exclude`, и удалялись;
* `--delete` – для удаления посторонних файлов из директории назначения (остаются только те, что имеются в источнике копирования) – была указана избыточно, поскольку `--delete-excluded` удаляет не только исключения, но и другие лишние файлы:

<kbd><img src="/img/sflt-3.1.5.png"></kbd>

---

> ### Задание 2
> *	Написать скрипт и настроить задачу на регулярное резервное копирование домашней директории пользователя с помощью rsync и cron.
> *	Резервная копия должна быть полностью зеркальной
> *	Резервная копия должна создаваться раз в день, в системном логе должна появляться запись об успешном или неуспешном выполнении операции
> *	Резервная копия размещается локально, в директории /tmp/backup
> *	На проверку направить файл crontab и скриншот с результатом работы утилиты.
>
### Ответ к заданию 2
:large_blue_diamond:	Написание скрипта для создания полностью зеркальной резервной копии домашней директории пользователя: 

<kbd><img src="/img/sflt-3.2.1.png"></kbd>

<kbd><img src="/img/sflt-3.2.2.png"></kbd>

:large_blue_diamond:	Проверка работоспособности скрипта в штатном режиме:

<kbd><img src="/img/sflt-3.2.3.png"></kbd>

<kbd><img src="/img/sflt-3.2.4.png"></kbd>

<kbd><img src="/img/sflt-3.2.5.png"></kbd>

:large_blue_diamond:	Проверка скрипта с поломкой:

<kbd><img src="/img/sflt-3.2.6.png"></kbd>

<kbd><img src="/img/sflt-3.2.7.png"></kbd>

<kbd><img src="/img/sflt-3.2.8.png"></kbd>

:large_blue_diamond:	Настройка crontab на выполнение скрипта каждый день в 01:22 с записью потока вывода и потока ошибок в системный лог:

<kbd><img src="/img/sflt-3.2.9.png"></kbd>

<kbd><img src="/img/sflt-3.2.10.png"></kbd>

:large_blue_diamond:	Проверка выполнения задачи при рабочем скрипте:

<kbd><img src="/img/sflt-3.2.11.png"></kbd>

<kbd><img src="/img/sflt-3.2.12.png"></kbd>

:large_blue_diamond:	Проверка выполнения задачи при сломанном скрипте (время crontab было перенесено на 01:37):

<kbd><img src="/img/sflt-3.2.13.png"></kbd>

---

> ### Задания со звёздочкой*
> Эти задания дополнительные. Их можно не выполнять. На зачёт это не повлияет. Вы можете их выполнить, если хотите глубже разобраться в материале.
>
> ### Задание 3*
> *	Настройте ограничение на используемую пропускную способность rsync до 1 Мб/c
> *	Проверьте настройку, синхронизируя большой файл между двумя серверами
> *	На проверку направьте команду и результат ее выполнения в виде скриншота
>
### Ответ к заданию 3*
:large_blue_diamond:	Проверяем, что на принимающей машине доступно подключение по SSH:

<kbd><img src="/img/sflt-3.3.1.png"></kbd>

:large_blue_diamond:	На машине-источнике генерируем ключи SSH, передаем на принимающую машину и производим подключение к ней:

<kbd><img src="/img/sflt-3.3.2.png"></kbd>

:large_blue_diamond:	На принимающую машину также установлен rsync:

<kbd><img src="/img/sflt-3.3.3.png"></kbd>

:large_blue_diamond:	Тестовый файл создан и передан с одной машины на другую. Для установки ограничения на пропускную способность использована опция `--bwlimit`:

<kbd><img src="/img/sflt-3.3.4.png"></kbd>

<kbd><img src="/img/sflt-3.3.5.png"></kbd>

---

> ### Задание 4*
> *	Напишите скрипт, который будет производить инкрементное резервное копирование домашней директории пользователя с помощью rsync на другой сервер
> *	Скрипт должен удалять старые резервные копии (сохранять только последние 5 штук)
> *	Напишите скрипт управления резервными копиями, в нем можно выбрать резервную копию и данные восстановятся к состоянию на момент создания данной резервной копии.
> *	На проверку направьте скрипт и скриншоты, демонстрирующие его работу в различных сценариях.
>
### Ответ к заданию 4*
:large_blue_diamond:	Ссылка на файл со скриптом:  
https://github.com/rappture/sys-19/blob/main/conf/sflt-3/incremental_backup_Task4.sh

:large_blue_diamond:	Скриншот текста скрипта:

<kbd><img src="/img/sflt-3.4.1.png"></kbd>

:large_blue_diamond:	Создание резервных копий с помощью скрипта:

<kbd><img src="/img/sflt-3.4.2.png"></kbd>

:large_blue_diamond:	Проверка результатов создания:

<kbd><img src="/img/sflt-3.4.3.png"></kbd>

:large_blue_diamond:	Ситуация, когда превышено число резервных копий:

<kbd><img src="/img/sflt-3.4.4.png"></kbd>

:large_blue_diamond:	Ситуация восстановления данных из нужной резервной копии:

<kbd><img src="/img/sflt-3.4.5.png"></kbd>
